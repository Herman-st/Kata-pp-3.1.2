<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Админ панель</title>
</head>
<body>
<h1>Админ панель</h1>

<form th:action="@{/logout}" method="post" style="float: right;">
    <button type="submit">Выйти</button>
</form>
<a th:href="@{/user}">Мой профиль</a>

<h2>Добавить нового пользователя</h2>
<form th:action="@{/admin/add}" method="post">
    <table>
        <tr>
            <td>Имя:</td>
            <td><input type="text" name="name" required></td>
        </tr>
        <tr>
            <td>Фамилия:</td>
            <td><input type="text" name="surname" required></td>
        </tr>
        <tr>
            <td>Email:</td>
            <td><input type="email" name="email" required></td>
        </tr>
        <tr>
            <td>Пароль:</td>
            <td><input type="password" name="password" required></td>
        </tr>
        <tr>
            <td>Роли:</td>
            <td>
                <div th:each="role : ${allRoles}">
                    <input type="checkbox" th:value="${role.id}" name="roles"
                           th:id="'role_' + ${role.id}">
                    <label th:for="'role_' + ${role.id}" th:text="${role.name}"></label>
                </div>
            </td>
        </tr>
        <tr>
            <td></td>
            <td><button type="submit">Добавить</button></td>
        </tr>
    </table>
</form>

<h2>Список пользователей</h2>
<table border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Имя</th>
        <th>Фамилия</th>
        <th>Email</th>
        <th>Роли</th>
        <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.name}"></td>
        <td th:text="${user.surname}"></td>
        <td th:text="${user.email}"></td>
        <!-- Используем метод getRolesAsString() -->
        <td th:text="${user.rolesAsString}"></td>
        <td>
            <form th:action="@{/admin/update}" method="post">
                <input type="hidden" name="id" th:value="${user.id}">

                Новое имя: <input type="text" name="name" th:value="${user.name}" size="10"><br>
                Новая фамилия: <input type="text" name="surname" th:value="${user.surname}" size="10"><br>
                Новый email: <input type="email" name="email" th:value="${user.email}" size="15"><br>
                Новый пароль: <input type="password" name="password" placeholder="Оставьте пустым чтобы не менять" size="15"><br>

                Роли:<br>
                <div th:each="role : ${allRoles}">
                    <input type="checkbox" th:value="${role.id}" name="roles"
                           th:id="'edit_' + ${user.id} + '_' + ${role.id}"
                           th:checked="${user.roles.contains(role)}">
                    <label th:for="'edit_' + ${user.id} + '_' + ${role.id}"
                           th:text="${role.name}"></label>
                </div>

                <button type="submit">Обновить</button>
            </form>

            <form th:action="@{/admin/delete}" method="post">
                <input type="hidden" name="id" th:value="${user.id}">
                <button type="submit" onclick="return confirm('Удалить пользователя?')">Удалить</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>